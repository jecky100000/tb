//------------------------------------------------------------------------
// 简称:  
// 名称: 潘敬
// 类别: 公式应用
// 类型: 用户应用
// 输出:
//------------------------------------------------------------------------

Vars
NumericSeries HHH;					//去影线的实体柱高价
NumericSeries LLL;					//去影线的实体柱低价
Numeric DM_H;						//DM顶点
Numeric	DM_L;						//DM底点	
NumericSeries flag;					//距上一颗不包含k线的根数
Numeric fff;						//类型编号
String ggg;							//箭头
String xxx;							//类型
String yyy;							//方向
Numeric color;						//颜色
  
Begin
HHH = Max(O,C);						//去影线
LLL = Min(O,C);						//去影线

If(HHH>HHH[1])						//创新高
{
	If(LLL>LLL[1])							//上挫出---------------------------------------------------------------------------------------1
	{
		fff = 1;
		xxx = "上挫出";
		flag = 1;
		DM_L = HHH[1];
		DM_H = HHH;
		color = red;
	}
	Else If(LLL<LLL[1])			  			//右包左
	{
		fff =2;
		xxx = "右包左";
		flag = flag+1;
		If(HHH>=HHH[flag])			//向上------------------------------------------------------------------------------------------------2↑
		{
			yyy = "向上";
			ggg = "↑";
			DM_L = LLL[1];
		    DM_H = HHH;
		   color = red;
		}
		Else						//向下------------------------------------------------------------------------------------------------2↓
		{
			ggg = "↓";
			yyy = "向下";
			DM_L = LLL;
		    DM_H = HHH[1];
		   color = Green;
		}
	}
	Else //(LLL==LLL[1])		    	//相等---右包左
	{
		fff =3;
		xxx = "右包左";
		flag = flag+1;
		If(HHH>=HHH[flag])			//向上------------------------------------------------------------------------------------------------3↑
		{
			ggg = "↑";
			yyy = "向上";
			DM_L = LLL[1];
		    DM_H = HHH;
		   color = Red;
		}
		Else						//向下//----------------------------------------------------------------------------------------------3↓
		{
			ggg = "↓";
			yyy = "向下";
			DM_L = LLL;
		    DM_H = HHH[1];
		   color = Green;
		}
	}
}
Else If(HHH<HHH[1]) 				//未创新高
{
	If(LLL<LLL[1])							//下挫出
	{
		fff =4;							//-------------------------------------------------------------------------------------------------4
		flag = 1;
		xxx  = "下挫出";
		DM_L = LLL;
		DM_H = LLL[1];
		color = Green;
	}
	Else If (LLL>LLL[1])					//左包右
	{
		fff =5;
		xxx = "左包右";
		flag = flag+1;
		If(LLL<=LLL[flag])				//------------------------------------------------------------------------------------------------5↓
		{
			
			ggg = "↓";
			yyy = "向下";
			DM_L = LLL[1];
		    DM_H = LLL[1]+hhh-LLL;
		   color = Green;
		}
		Else							//------------------------------------------------------------------------------------------------5↑
		{
			ggg = "↑";
			yyy = "向上";
			DM_L = LLL;
		    DM_H = hhh[1];
		   color = Red;
		}
	}
	Else//(LLL==LLL[1])		    		//相等--左包右
	{
		fff =6;				
		xxx = "左包右";
		flag = flag+1;
		If(LLL<LLL[flag])				//------------------------------------------------------------------------------------------------6↓
		{
			
			ggg = "↓";
			yyy = "向下";
			DM_L = LLL[1];
		    DM_H = LLL[1]+hhh-LLL;
		   color = Green;
		}
		Else							//------------------------------------------------------------------------------------------------6↑
		{
			ggg = "↑";
			yyy = "向上";
			DM_L = LLL;
		    DM_H = LLL+hhh-LLL;
		   color = Red;
		}
	}
}
Else //(HHH==HHH[1])	
{
	If(LLL<LLL[1])							//右包左
	{
		fff =7;
		flag = flag+1;
		If(LLL<LLL[flag])				//------------------------------------------------------------------------------------------------7↓
		{
			ggg = "↓";
			yyy = "向下";
			DM_L = LLL;
		    DM_H = LLL[1];
		   color = Green;
		}
		Else							//------------------------------------------------------------------------------------------------7↑
		{
			ggg = "↑";
			yyy = "向上";
			DM_L = LLL;
		    DM_H = hhh[1];
		   color = Red;
		}
	}
	Else If (LLL>LLL[1])					//左包右
	{
		fff =8;
		xxx = "左包右";
		flag = flag+1;
		If(LLL<LLL[flag])				//------------------------------------------------------------------------------------------------8↓
		{
			ggg = "↓";
			yyy = "向下";
			DM_L = LLL[1];
		    DM_H = lll[1]+hhh-LLL;
		   color = Green;
		}
		Else							//------------------------------------------------------------------------------------------------8↑
		{
			ggg = "↑";
			yyy = "向上";
			DM_L = LLL;
		    DM_H = hhh[1];
		   color = Red;
		}
	}
	Else//(LLL==LLL[1])		    		//相等--左包右
	{
		fff =9;
		xxx = "左包右";
		flag = flag+1;
		If(LLL<LLL[flag])//------------------------------------------------------------------------------------------------9↓
		{
			ggg = "↓";
			yyy = "向下";
			DM_L = LLL[1];
		    DM_H = lll[1]+hhh-LLL;
		   color = Green;
		}
		Else            //------------------------------------------------------------------------------------------------9↑
		{
			ggg = "↑";
			yyy = "向上";
			DM_L = LLL;
		    DM_H = LLL+hhh-LLL;
		   color = Red;
		}
	}
}
PlotNumeric("k线",DM_L,DM_H,color);
PlotString("上标",Text(fff)+ggg,0,IIF(fff == 1,255,IIF(fff ==4,65280,white)));
Commentary(xxx);
Commentary(yyy);
Commentary("顶 = "+text(DM_H));
Commentary("底 = "+text(DM_L));
Commentary("柱高 = "+text(DM_H-DM_L));
End

//------------------------------------------------------------------------
// 编译版本	GS2015.12.25
// 用户版本	2017/06/28 10:28:54
// 版权所有	wkjytj
// 更改声明	TradeBlazer Software保留对TradeBlazer平台
//			每一版本的TradeBlazer公式修改和重写的权利
//------------------------------------------------------------------------